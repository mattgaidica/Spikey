fdataseg = wavefilter(sev(1:1e6)-cma(1:1e6),6);
fdatasegNA = artifactThresh(fdataseg, 500);

nplot = 5;

figure;
hs(1) = subplot(nplot,1,1);
plot(fdatasegNA);
title('fdataseg')

sm = 10;
fds = smooth(fdataseg2,sm);
hs(2) = subplot(nplot,1,2);
plot(fds);
title('fds')

diffdata = diff(fds);
hs(3) = subplot(nplot,1,3);
plot(diffdata);
title('diffdata')

diffmult = diffdata.*(fds(2:end));
hs(4) = subplot(nplot,1,4);
plot(diffmult);
title('diffdata.*(fds2(2:end))');

diffdiffmult = abs(diff(smooth(diffmult)));
hs(5) = subplot(nplot,1,5);
plot(diffdiffmult);
title('abs(diff(smooth(diffmult)))');

linkaxes(hs,'x')

%findpeaks(diffdiffmult,'MinPeakDistance',15,'MinPeakHeight',1e6,'Annotate','extents');
